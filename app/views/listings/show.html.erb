<div class="listing-slides">
  <% if @listing.listingphotos.first %>
    <% if @listing.listingphotos.first %>
    <%= image_tag @listing.listingphotos.first.photo.url, alt:"First slide", class: "photo-slide photo-slide-1 active"%>
    <% end %>

    <% if @listing.listingphotos.second %>
    <%= image_tag @listing.listingphotos.second.photo.url, alt:"Second slide", class: "photo-slide photo-slide-2"%>
    <% end %>

    <% if @listing.listingphotos.third %>
    <%= image_tag @listing.listingphotos.third.photo.url, alt:"Third slide", class: "photo-slide photo-slide-3"%>
    <% end %>
    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
  <% end %>
</div>

<div class="profile_picture listing-profile">
  <% if @listing.user && @listing.user.picture %>
    <%= image_tag @listing.user.picture %>
  <% else %>
    <img src="/assets/missing.jpg">
  <% end %>
  <% unless @listing.user == current_user %>
  <div class="similarity_info">
    <div>
      <h1>
        <%= current_user.similarity_with(@listing.user) %>
      </h1>
    </div>
  </div>
  <% end %>
  <div class="profile_panel">
    <h2>
      <%= @listing.user.name %>
    </h2>

    <% if current_user.friends.include?(@listing.user) %>
        <%= link_to "Email Friend", @listing.user, class: "btn btn-danger" %>
        <br>
        <br>
        <%= link_to "Remove Friend", remove_path %>
        <br>
    <% elsif current_user.requests_to.include?(@listing.user)%>
        <%= link_to "Cancel Request", cancel_path(@listing.user), class: "btn btn-default" %>
    <% elsif current_user.requests_from.include?(@listing.user) %>
        <%= link_to "Accept", accept_path, class: "btn btn-primary" %>
        <%= link_to "Ignore", ignore_path, class: "btn btn-default" %>
    <% elsif current_user == @listing.user %>
      <br>
    <% else %>
        <%= link_to "Add Friend", request_path, class: "btn btn-info" %>
    <% end %>
    <% if @listing.user.responses.last.nil? && @listing.user == current_user %>
      <%= link_to "Complete Questionnaire", response_path, class: "btn btn-success" %>
    <% end %>
    <% if @listing.user == current_user %>
      <%= link_to 'Edit Login', edit_user_path(@listing.user),  class: "btn btn-default edit_profile"%>
    <% end %>
  </div>
</div>

<div class="listing_info info-rent">
  <% if @listing && @listing.rent %>
    <h3>
      $<%= @listing.rent %>
    </h3>
    <p>
      /month
    </p>
  <% end %>
</div>
<div class="listing_info info-date">
  <% if @listing.move_in_day %>
    <p>
      Move-in: <%= @listing.move_in_day %>
    </p>
  <% elsif @listing.user.responses.last && @listing.user.responses.last.move_in_date %>
    <p>
      Move-in: <%= @listing.user.responses.last.move_in_date %>
    </p>
  <% end %>
</div>
<div class="listing_info info-duration">
  <% if @listing.stay_duration %>
    <p>
      Duration: <%= @listing.stay_duration %>
    </p>
  <% elsif @listing.user.responses.last && @listing.user.responses.last.duration %>
    <p>
      <% @listing.user.responses.last.duration %>
    </p>
  <% end %>
</div>

<div id="map" style="
    overflow: hidden;
    float: left;
    margin: -20em 0 0 15em;
    width: 45%;
    height: 30em;"></div>

<script>
  window.addresses = [];
  window.addresses.push("<%= [@listing.address, @listing.city, @listing.state, @listing.zipcode].join(",") %>");
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDPW_yVez7lt-3QKXCXk97t43Q2TdZkQZQ&libraries=places&callback=initMap"
    async defer></script>

<% if current_user.listing && @listing == current_user.listing %>
  <%= link_to 'Edit Your Apartment', edit_listing_path(@listing) %>
  <% if current_user.listing.listingphotos == 0 %>
    | <%= link_to 'Add Photos to Your Apartment', new_listingphoto_path %>
  <% elsif current_user.listing.listingphotos.size > 0 && current_user.listing.listingphotos.size < 12 %>
    | <%= link_to 'Add Photos to Your Apartment', new_listingphoto_path %>
    | <%= link_to 'Edit Your Apartment Photos', listingphoto_path %>
  <% else %>
    | <%= link_to 'Edit Your Apartment Photos', listingphoto_path %>
  <% end %>
<% end %>
